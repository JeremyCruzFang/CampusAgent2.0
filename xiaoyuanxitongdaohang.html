<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="description" content="NUIST 入学助手：校内系统导航（统一入口）" />
  <meta name="theme-color" content="#0B1020" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="format-detection" content="telephone=no,email=no,address=no" />

  <meta property="og:title" content="校内系统导航｜NUIST 入学助手" />
  <meta property="og:description" content="把常用校内系统放在一个页面：快速找到、复制链接、在浏览器打开。" />
  <meta property="og:type" content="website" />

  <title>校内系统导航｜NUIST 入学助手</title>

  <style>:root{
      --bg: #050509;
      --panel: rgba(255,255,255,0.06);
      --panel2: rgba(255,255,255,0.08);
      --text: rgba(255,255,255,0.92);
      --muted: rgba(255,255,255,0.68);
      --hair: rgba(255,255,255,0.12);
      --brand: rgb(167, 139, 250);
      --brand2: rgb(96, 165, 250);
      --ring: rgba(167, 139, 250, 0.55);
      --shadow: 0 18px 50px rgba(0,0,0,0.55);
      --r2xl: 22px;
      --rxl: 16px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    

    .bg-fixed{
      position: fixed;
      inset: -20vh -20vw;
      z-index: -2;
      pointer-events: none;
      background:
        radial-gradient(1400px 900px at 18% 0%,
          rgba(167,139,250,0.13) 0%,
          rgba(167,139,250,0.07) 42%,
          rgba(5,5,9,0.00) 76%),
        radial-gradient(1400px 900px at 88% 10%,
          rgba(96,165,250,0.13) 0%,
          rgba(96,165,250,0.07) 42%,
          rgba(5,5,9,0.00) 76%),
        linear-gradient(180deg, rgba(5,5,9,1) 0%, rgba(5,5,9,1) 100%);
      transform: translateZ(0);
      will-change: transform;
      filter: saturate(1.04);
    }
    /* subtle vignette to keep the bottom calm */
    .bg-fixed::after{
      content:"";
      position:absolute;
      inset:0;
      background: radial-gradient(1200px 720px at 50% 42%, rgba(0,0,0,0.0) 0%, rgba(0,0,0,0.42) 100%);
    }

body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color:var(--text);
      background:
        radial-gradient(1200px 800px at 18% 8%, rgba(167, 139, 250, 0.18), transparent 55%),
        radial-gradient(1200px 800px at 88% 26%, rgba(96, 165, 250, 0.18), transparent 55%),
        var(--bg);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    a{ color:inherit; text-decoration:none; }

    .wrap{ max-width: 980px; margin: 0 auto; padding: 18px 14px 84px; }

    .topbar{
      position: sticky;
      top: 10px;
      z-index: 50;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      padding: 10px 12px;
      border-radius: var(--r2xl);
      background: rgba(0,0,0,0.35);
      border: 1px solid var(--hair);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }

    .left{
      display:flex;
      align-items:center;
      gap: 10px;
      min-width: 0;
    }

    .back{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      width: 42px;
      height: 42px;
      border-radius: 14px;
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.12);
      cursor:pointer;
      user-select:none;
    }
    .back:focus{ outline: 3px solid var(--ring); outline-offset: 3px; }

    .brandmark{
      width: 28px;
      height: 28px;
      border-radius: 10px;
      background: linear-gradient(135deg, rgba(167,139,250,0.9), rgba(96,165,250,0.9));
      display:flex;
      align-items:center;
      justify-content:center;
      box-shadow: 0 10px 26px rgba(0,0,0,0.45);
      flex: 0 0 auto;
    }
    .brandmark svg{ width: 18px; height: 18px; color: rgba(255,255,255,0.92); }

    .titleblock{ min-width: 0; }
    .title{
      font-size: 15px;
      letter-spacing: 0.2px;
      margin:0;
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
    }
    .subtitle{
      margin: 2px 0 0;
      font-size: 13px;
      color: var(--muted);
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
    }

    .lang{
      display:flex;
      gap: 8px;
      align-items:center;
      flex: 0 0 auto;
    }
    .pill{
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(255,255,255,0.06);
      padding: 8px 10px;
      border-radius: 999px;
      font-size: 12px;
      color: rgba(255,255,255,0.86);
      cursor:pointer;
      user-select:none;
    }
    .pill[aria-pressed="true"]{
      background: rgba(167,139,250,0.20);
      border-color: rgba(167,139,250,0.55);
    }
    .pill:focus{ outline: 3px solid var(--ring); outline-offset: 3px; }

    .hero{
      margin: 18px auto 0;
      max-width: 920px;
      padding: 24px 24px;
      border-radius: var(--r2xl);
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.10);
      box-shadow: var(--shadow);
    }
    .hero h1{
      margin: 0 0 10px;
      font-size: 24px;
      letter-spacing: 0.2px;
    }
    .hero p{
      margin:0;
      color: var(--muted);
      line-height: 1.7;
      font-size: 15px;
    }

    .tools{
      margin-top: 12px;
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items:center;
    }
    .search{
      flex: 1 1 240px;
      display:flex;
      align-items:center;
      gap: 10px;
      padding: 12px 12px;
      border-radius: 16px;
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.12);
    }
    .search input{
      width: 100%;
      border: none;
      outline: none;
      background: transparent;
      color: var(--text);
      font-size: 14px;
    }
    .chiprow{
      display:flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    .chip{
      font-size: 12px;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(255,255,255,0.05);
      color: rgba(255,255,255,0.84);
      cursor:pointer;
      user-select:none;
    }
    .chip[aria-pressed="true"]{
      background: rgba(96,165,250,0.18);
      border-color: rgba(96,165,250,0.55);
    }
    .chip:focus{ outline: 3px solid var(--ring); outline-offset: 3px; }

    .grid{
      margin: 16px auto 0;
      max-width: 920px;
      display:grid;
      grid-template-columns: 1fr;
      gap: 14px;
    }

    .item{
      padding: 26px 26px;
      border-radius: var(--r2xl);
      min-height: 360px;
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(255,255,255,0.05);
      display:flex;
      justify-content:space-between;
      gap: 12px;
      transition: transform 180ms ease, background 180ms ease, border-color 180ms ease;
    }
    .item:hover{ transform: translateY(-1px); background: rgba(255,255,255,0.06); border-color: rgba(255,255,255,0.16); }
    .item:focus{ outline: 3px solid var(--ring); outline-offset: 3px; }

    .meta{ min-width: 0; }
    .name{ margin:0; font-size: 22px; letter-spacing: 0.2px; }
    .desc{ margin:10px 0 0; color: var(--muted); font-size: 16px; line-height: 1.75; }

    .right{
      display:flex;
      flex-direction: column;
      align-items:flex-end;
      gap: 8px;
      flex: 0 0 auto;
    }
    .tags{ display:flex; gap: 6px; flex-wrap: wrap; justify-content:flex-end; }
    .tag{
      font-size: 12px;
      padding: 5px 8px;
      border-radius: 999px;
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.12);
      color: rgba(255,255,255,0.80);
      white-space: nowrap;
    }
    .tag.brand{ background: rgba(167,139,250,0.14); border-color: rgba(167,139,250,0.35); }
    .tag.blue{ background: rgba(96,165,250,0.14); border-color: rgba(96,165,250,0.35); }

    .action{
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    .btn{
      font-size: 14px;
      padding: 11px 14px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(255,255,255,0.06);
      color: rgba(255,255,255,0.86);
      cursor:pointer;
      user-select:none;
    }
    .btn.primary{
      border-color: rgba(96,165,250,0.55);
      background: rgba(96,165,250,0.16);
    }
    .btn:focus{ outline: 3px solid var(--ring); outline-offset: 3px; }

    /* Sheet (WeChat guard) */
    .sheet-backdrop{
      position:fixed; inset:0;
      background: rgba(0,0,0,0.50);
      opacity:0; pointer-events:none;
      transition: opacity 180ms ease;
      z-index: 9997;
    }
    .sheet-backdrop.show{ opacity:1; pointer-events:auto; }

    .sheet{
      position:fixed; left:0; right:0; bottom:-420px;
      z-index: 9998;
      transition: transform 220ms ease;
      transform: translateY(0);
      pointer-events:none;
    }
    .sheet.show{ transform: translateY(-420px); pointer-events:auto; }
    .sheet-card{
      margin: 0 12px 14px;
      border-radius: 20px;
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(14, 14, 20, 0.96);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .sheet-head{
      padding: 14px 14px 10px;
      border-bottom: 1px solid rgba(255,255,255,0.10);
    }
    .sheet-title{ margin:0; font-size: 14px; }
    .sheet-desc{ margin: 6px 0 0; color: var(--muted); font-size: 12px; line-height: 1.5; }
    .sheet-actions{ padding: 12px 14px 14px; display:grid; gap: 10px; }
    .sheet-btn{
      width: 100%;
      padding: 12px 12px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(255,255,255,0.06);
      color: rgba(255,255,255,0.92);
      font-size: 13px;
      cursor:pointer;
    }
    .sheet-btn.primary{ border-color: rgba(96,165,250,0.55); background: rgba(96,165,250,0.18); }
    .sheet-btn:focus{ outline: 3px solid var(--ring); outline-offset: 3px; }

    .toast{
      position: fixed;
      left: 50%;
      bottom: 28px;
      transform: translateX(-50%);
      padding: 10px 12px;
      border-radius: 999px;
      background: rgba(0,0,0,0.72);
      border: 1px solid rgba(255,255,255,0.14);
      color: rgba(255,255,255,0.92);
      font-size: 12px;
      opacity: 0;
      pointer-events:none;
      transition: opacity 160ms ease, transform 160ms ease;
      z-index: 9999;
    }
    .toast.show{ opacity: 1; transform: translateX(-50%) translateY(-4px); }
  
    /* Keep content away from the browser UI + safe-area */
      .wrap{
        padding-top: calc(26px + env(safe-area-inset-top));
        padding-bottom: calc(140px + env(safe-area-inset-bottom));
      }

      /* Ensure sticky header doesn't overlap content on iOS */
      .topbar{
        top: calc(10px + env(safe-area-inset-top));
      }

      /* Slightly more compact typography on narrow screens */
      .hero{ padding: 20px 20px; }
      .hero h1{ font-size: 22px; }
      .hero p{ font-size: 14px; line-height: 1.7; }

      .item{ padding: 22px 22px; min-height: 0; }
      .name{ font-size: 20px; }
      .desc{ font-size: 15px; line-height: 1.75; }

@media (max-width: 520px){
  .bg-fixed{ opacity: 0.92; }

  .wrap{
    padding-top: calc(26px + env(safe-area-inset-top));
    padding-bottom: calc(140px + env(safe-area-inset-bottom));
}

  .topbar{
    top: calc(10px + env(safe-area-inset-top));
  }

  .hero{
    padding: 20px 20px;
  }

  .hero h1{
    font-size: 22px;
  }

  .hero p{
    font-size: 14px;
    line-height: 1.7;
  }

  .item{
    padding: 22px 22px;
    min-height: 0;
  }

  .name{
    font-size: 20px;
  }

  .desc{
    font-size: 15px;
    line-height: 1.75;
  }
}
</style>
</head>

<body>
  <div class="bg-fixed" aria-hidden="true"></div>
  <div class="wrap">
    <div class="topbar" role="navigation" aria-label="Top bar">
      <div class="left">
        <button class="back" id="backBtn" aria-label="Back">
          <svg viewBox="0 0 24 24" fill="none">
            <path d="M15 6l-6 6 6 6" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>

        <div class="brandmark" aria-hidden="true" title="NUIST">
          <svg viewBox="0 0 64 64" fill="none">
            <path d="M18 46V18" stroke="currentColor" stroke-width="5.2" stroke-linecap="round"/>
            <path d="M46 46V18" stroke="currentColor" stroke-width="5.2" stroke-linecap="round"/>
            <path d="M18 18L46 46" stroke="currentColor" stroke-width="5.2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>

        <div class="titleblock">
          <p class="title" data-i18n="page_title">校内系统导航</p>
          <p class="subtitle" data-i18n="page_sub">统一入口：查找、复制链接、在浏览器打开</p>
        </div>
      </div>

      <div class="lang" aria-label="Language switch">
        <button class="pill" data-lang="zh" aria-pressed="true">中</button>
        <button class="pill" data-lang="en" aria-pressed="false">EN</button>
      </div>
    </div>

    <div class="hero">
      <h1 data-i18n="hero_title">校内系统导航</h1>
      <p class="hero-desc-custom">南京信息工程大学（NUIST）校内各类功能系统，均在完成统一身份认证（SSO）后集中呈现。本页不对具体系统逐一展开介绍。新生完成 SSO 登录后，即可按个人身份访问学习事务、校园生活相关服务（包括宿舍、体育场馆与图书馆等）等重要信息。需要注意的是，该功能在企业微信中的使用体验相对有限。</p>

      </div>
    </div>

    <div class="grid" id="grid" aria-label="Systems list">
      <!-- Items are injected by JS -->
    </div>
  </div>

  <div class="sheet-backdrop" id="sheetBackdrop" aria-hidden="true"></div>
  <div class="sheet" id="sheet" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="sheet-card">
      <div class="sheet-head">
        <p class="sheet-title" id="sheetTitle">打开链接</p>
        <p class="sheet-desc" id="sheetDesc">部分链接在微信内可能受限，可复制后在浏览器打开。</p>
      </div>
      <div class="sheet-actions">
        <button class="sheet-btn primary" id="sheetCopy">复制链接</button>
        <button class="sheet-btn" id="sheetOpen">在微信内打开</button>
        <button class="sheet-btn" id="sheetCancel">取消</button>
      </div>
    </div>
  </div>

  <div class="toast" id="toast" role="status" aria-live="polite"></div>

  <script>
    (function(){
      var ENV_WECHAT = /MicroMessenger/i.test(navigator.userAgent || "");
      var toastTimer = null;

      var i18n = {
        zh: {
          page_title: "校内系统导航",
          page_sub: "统一入口：查找、复制链接、在浏览器打开",
          hero_title: "校内系统导航",
          hero_desc: "把常用校内系统放在一个页面。部分系统需要统一身份认证；在微信内打不开时，可复制链接到浏览器打开。",
          chip_all: "全部",
          chip_auth: "需登录",
          chip_life: "生活服务",
          chip_study: "学习教务",
          search_ph: "搜索：教务 / 校园卡 / 图书馆…",
          open_link: "打开链接",
          open_desc: "部分链接在微信内可能受限，可复制后在浏览器打开。",
          copy: "复制链接",
          open_in_wechat: "在微信内打开",
          cancel: "取消",
          copied: "链接已复制",
          copy_fail: "复制失败，请长按手动复制",
          coming: "内容准备中，稍后开放",
          btn_open: "打开",
          btn_copy: "复制"
        },
        en: {
          page_title: "Campus Systems",
          page_sub: "One hub: find, copy, open in browser",
          hero_title: "Campus Systems",
          hero_desc: "A single hub for common campus systems. Some require SSO. If WeChat blocks a link, copy it and open in your browser.",
          chip_all: "All",
          chip_auth: "Login required",
          chip_life: "Campus life",
          chip_study: "Academic",
          search_ph: "Search: SIS / card / library…",
          open_link: "Open link",
          open_desc: "Some links may be restricted in WeChat. Copy and open in your browser.",
          copy: "Copy link",
          open_in_wechat: "Open in WeChat",
          cancel: "Cancel",
          copied: "Link copied",
          copy_fail: "Copy failed. Long-press to copy",
          coming: "Content is coming soon",
          btn_open: "Open",
          btn_copy: "Copy"
        }
      };

      function getSavedLang(){
        try { return localStorage.getItem("lang") || "zh"; } catch(e){ return "zh"; }
      }
      function setSavedLang(lang){
        try { localStorage.setItem("lang", lang); } catch(e){}
      }
      function safeSetText(el, val){
        if (typeof val !== "string") return;
        el.textContent = val;
      }

      var sheet = document.getElementById("sheet");
      var sheetBackdrop = document.getElementById("sheetBackdrop");
      var sheetTitle = document.getElementById("sheetTitle");
      var sheetDesc = document.getElementById("sheetDesc");
      var sheetCopy = document.getElementById("sheetCopy");
      var sheetOpen = document.getElementById("sheetOpen");
      var sheetCancel = document.getElementById("sheetCancel");

      var sheetHref = "";

      function showToast(msg){
        var toast = document.getElementById("toast");
        if (!toast) return;
        toast.textContent = msg;
        toast.classList.add("show");
        if (toastTimer) window.clearTimeout(toastTimer);
        toastTimer = window.setTimeout(function(){ toast.classList.remove("show"); }, 1400);
      }

      function closeSheet(){
        sheet.classList.remove("show");
        sheetBackdrop.classList.remove("show");
        sheet.setAttribute("aria-hidden", "true");
        sheetBackdrop.setAttribute("aria-hidden", "true");
      }

      function openSheet(href, dict){
        sheetHref = href || "";
        safeSetText(sheetTitle, dict.open_link);
        safeSetText(sheetDesc, dict.open_desc);
        safeSetText(sheetCopy, dict.copy);
        safeSetText(sheetOpen, dict.open_in_wechat);
        safeSetText(sheetCancel, dict.cancel);

        sheet.classList.add("show");
        sheetBackdrop.classList.add("show");
        sheet.setAttribute("aria-hidden", "false");
        sheetBackdrop.setAttribute("aria-hidden", "false");
      }

      async function copyToClipboard(text){
        try{
          if (navigator.clipboard && navigator.clipboard.writeText){
            await navigator.clipboard.writeText(text);
            return true;
          }
        }catch(e){}
        try{
          var ta = document.createElement("textarea");
          ta.value = text;
          ta.style.position = "fixed";
          ta.style.left = "-9999px";
          document.body.appendChild(ta);
          ta.select();
          var ok = document.execCommand("copy");
          document.body.removeChild(ta);
          return ok;
        }catch(e){
          return false;
        }
      }

      sheetBackdrop.addEventListener("click", closeSheet);
      sheetCancel.addEventListener("click", closeSheet);
      sheetOpen.addEventListener("click", function(){
        if (!sheetHref) return closeSheet();
        window.location.href = sheetHref;
      });
      sheetCopy.addEventListener("click", async function(){
        if (!sheetHref) return closeSheet();
        var dict = i18n[currentLang] || i18n.zh;
        var ok = await copyToClipboard(sheetHref);
        showToast(ok ? dict.copied : dict.copy_fail);
        closeSheet();
      });

      
      var systems = [
        {
          key: "sso",
          zh: {
            name: "统一身份认证（SSO）",
            desc: "大多数校内系统的统一入口。首次使用建议在浏览器中打开。"
          },
          en: {
            name: "Unified Identity Authentication (SSO)",
            desc: "The single sign-on entry for most campus systems."
          },
          href: "https://authserver.nuist.edu.cn/",
          tags: ["auth","study"],
          badges: ["需登录","官方"],
          bullets_zh: [
            "教务系统：课表、成绩、选课等学习事务",
            "校园卡与缴费：充值、消费记录与相关服务",
            "图书馆系统：馆藏检索、借阅、续借与预约",
            "后勤报修：宿舍与公共设施报修、进度查询"
          ],
          bullets_en: [
            "Academic system: courses, grades and enrollment",
            "Campus card & payments: top-up and transaction records",
            "Library system: search, borrow, renew and reserve",
            "Maintenance services: submit and track repair requests"
          ],
          highlight_zh: "校园网络通常需要单独办理学校与运营商合作的电话卡。若你还未准备，可先前往首页「校园流量卡」，查看我们为新生整理的可靠方案。",
          highlight_en: "Campus network access usually requires a SIM card provided through the university–carrier program. If you haven't prepared one yet, visit “Campus Data Plans” on the homepage for curated options."
        }
      ];


      function normalizeBadge(b, lang){
        if (lang === "en"){
          if (b === "需登录") return "Login";
          if (b === "官方") return "Official";
          return b;
        }
        return b;
      }

      
      function buildItem(sys, lang, dict){
        var data = sys[lang] || sys.zh;

        var item = document.createElement("div");
        item.className = "item";
        item.tabIndex = 0;

        var meta = document.createElement("div");
        meta.className = "meta";

        var h = document.createElement("p");
        h.className = "name";
        h.textContent = data.name;

        var d = document.createElement("p");
        d.className = "desc";
        d.textContent = data.desc;

        meta.appendChild(h);

        // badges on top-right (but inside meta, aligned end)
        var tags = document.createElement("div");
        tags.className = "tags";
        tags.style.justifyContent = "flex-start";
        tags.style.marginTop = "10px";
        (sys.badges || []).forEach(function(b){
          var t = document.createElement("span");
          var bn = normalizeBadge(b, lang);
          t.className = "tag" + (b === "官方" ? " blue" : (b === "需登录" ? " brand" : ""));
          t.textContent = bn;
          tags.appendChild(t);
        });

        meta.appendChild(tags);
        meta.appendChild(d);

        // important note: first use in browser (make it obvious)
        var noteBox = document.createElement("div");
        noteBox.style.margin = "14px 0 0";
        noteBox.style.padding = "14px 14px";
        noteBox.style.borderRadius = "18px";
        noteBox.style.border = "1px solid rgba(96,165,250,0.55)";
        noteBox.style.background = "rgba(96,165,250,0.14)";
        noteBox.style.display = "flex";
        noteBox.style.gap = "10px";
        noteBox.style.alignItems = "flex-start";

        var icon = document.createElement("div");
        icon.style.width = "30px";
        icon.style.height = "30px";
        icon.style.borderRadius = "12px";
        icon.style.background = "rgba(96,165,250,0.22)";
        icon.style.display = "flex";
        icon.style.alignItems = "center";
        icon.style.justifyContent = "center";
        icon.innerHTML = '<svg viewBox="0 0 24 24" fill="none" style="width:16px;height:16px;color:rgba(255,255,255,0.92)"><path d="M12 8v5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><path d="M12 16h.01" stroke="currentColor" stroke-width="3" stroke-linecap="round"/><path d="M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" stroke="currentColor" stroke-width="1.6" opacity="0.9"/></svg>';

        var txt = document.createElement("div");
        txt.style.fontSize = "14px";
        txt.style.lineHeight = "1.65";
        txt.style.color = "rgba(255,255,255,0.94)";
        txt.innerHTML = (lang === "zh")
          ? '<strong style="font-weight:650">建议：</strong>首次使用请尽量在浏览器中打开，以便完成登录与跳转。'
          : '<strong style="font-weight:650">Tip:</strong> For your first sign-in, open in a browser to complete authentication smoothly.';

        noteBox.appendChild(icon);
        noteBox.appendChild(txt);
        meta.appendChild(noteBox);

        // divider
        function divider(){
          var hr = document.createElement("div");
          hr.style.height = "1px";
          hr.style.margin = "18px 0 16px";
          hr.style.background = "rgba(255,255,255,0.10)";
          meta.appendChild(hr);
        }

        divider();

        // bullets: the sub-systems covered by SSO
        var bullets = sys[lang === "zh" ? "bullets_zh" : "bullets_en"];
        if (bullets && bullets.length) {
          var ul = document.createElement("ul");
          ul.style.margin = "0";
          ul.style.paddingLeft = "18px";
          ul.style.color = "rgba(255,255,255,0.74)";
          ul.style.fontSize = "15px";
          ul.style.lineHeight = "1.85";
          bullets.forEach(function(t){
            var li = document.createElement("li");
            li.textContent = t;
            ul.appendChild(li);
          });
          meta.appendChild(ul);
        }

        // highlight note (network) - neutral callout
        var note = sys[lang === "zh" ? "highlight_zh" : "highlight_en"];
        if (note) {
          var box = document.createElement("div");
          box.style.margin = "0";
          box.style.padding = "14px 14px";
          box.style.borderRadius = "18px";
          box.style.border = "1px solid rgba(255,255,255,0.12)";
          box.style.background = "rgba(255,255,255,0.05)";

          var t = document.createElement("div");
          t.style.fontSize = "13px";
          t.style.fontWeight = "650";
          t.style.letterSpacing = "0.2px";
          t.style.color = "rgba(255,255,255,0.92)";
          t.textContent = (lang === "zh") ? "关于校园网络" : "About campus network";

          var p = document.createElement("div");
          p.style.marginTop = "8px";
          p.style.fontSize = "14.5px";
          p.style.lineHeight = "1.75";
          p.style.color = "rgba(255,255,255,0.74)";
          p.textContent = note;

          box.appendChild(t);
          box.appendChild(p);
          meta.appendChild(box);
        }

        

        // enterprise wechat note
        var ew = document.createElement("p");
        ew.textContent = (lang === "zh")
          ? "以上相关功能亦可通过学校企业微信查看与使用（不包含校园流量卡方案）。"
          : "The above services are also available via the university’s Enterprise WeChat (excluding campus data plan options).";
        ew.style.margin = "0";
        ew.style.fontSize = "13.5px";
        ew.style.lineHeight = "1.7";
        ew.style.color = "rgba(255,255,255,0.62)";
        meta.appendChild(ew);

        // actions
        var action = document.createElement("div");
        action.className = "action";
        action.style.marginTop = "18px";

        var openBtn = document.createElement("button");
        openBtn.className = "btn primary";
        openBtn.type = "button";
        openBtn.textContent = dict.btn_open;

        var copyBtn = document.createElement("button");
        copyBtn.className = "btn";
        copyBtn.type = "button";
        copyBtn.textContent = dict.btn_copy;

        function onOpen(){
          if (!sys.href || sys.href === "#"){
            showToast(dict.coming);
            return;
          }
          // If WeChat blocks, use sheet; otherwise open directly
          if (ENV_WECHAT && /^https?:\/\//i.test(sys.href) && !sys.whitelist){
            openSheet(sys.href, dict);
            return;
          }
          window.location.href = sys.href;
        }

        openBtn.addEventListener("click", onOpen);
        copyBtn.addEventListener("click", async function(){
          if (!sys.href || sys.href === "#"){
            showToast(dict.coming);
            return;
          }
          var ok = await copyToClipboard(sys.href);
          showToast(ok ? dict.copied : dict.copy_fail);
        });

        action.appendChild(openBtn);
        action.appendChild(copyBtn);
        meta.appendChild(action);

        item.appendChild(meta);

        item.addEventListener("click", function(e){
          if (e.target && (e.target.tagName === "BUTTON")) return;
          onOpen();
        });
        item.addEventListener("keydown", function(e){
          if (e.key === "Enter") onOpen();
        });

        // For search/filter
        item.dataset.search = (data.name + " " + data.desc + " " + (bullets || []).join(" ") + " " + (note || "")).toLowerCase();
        item.dataset.tags = (sys.tags || []).join(",");

        return item;
      }

      var currentLang = getSavedLang();
      function applyLanguage(lang){
        currentLang = lang;
        var dict = i18n[lang] || i18n.zh;
        document.documentElement.lang = lang === "zh" ? "zh-CN" : "en";
        document.title = lang === "zh" ? "校内系统导航｜NUIST 入学助手" : "Campus Systems | NUIST Assistant";

        // text nodes
        var nodes = document.querySelectorAll("[data-i18n]");
        nodes.forEach(function(el){ safeSetText(el, dict[el.dataset.i18n]); });

        // page description
        var desc = document.querySelector(".hero-desc-custom");
        if (desc) {
          desc.textContent = (lang === "zh") ? "南京信息工程大学（NUIST）校内各类功能系统，均在完成统一身份认证（SSO）后集中呈现。本页不对具体系统逐一展开介绍。新生完成 SSO 登录后，即可按个人身份访问学习事务、校园生活相关服务（包括宿舍、体育场馆与图书馆等）等重要信息。需要注意的是，该功能在企业微信中的使用体验相对有限。" : "At Nanjing University of Information Science & Technology (NUIST), most campus systems are accessed after completing Unified Identity Authentication (SSO). This page does not enumerate each system individually. Once signed in via SSO, students can access key academic and campus-life services (including dormitories, sports facilities, and the library). Please note that functionality may be limited when accessed through Enterprise WeChat.";
        }

        render();
      }

      function setLangButtons(lang){
        document.querySelectorAll(".pill").forEach(function(btn){
          var on = btn.dataset.lang === lang;
          btn.setAttribute("aria-pressed", on ? "true" : "false");
        });
      }

      function setFilterButtons(filter){
        document.querySelectorAll(".chip").forEach(function(btn){
          var on = btn.dataset.filter === filter;
          btn.setAttribute("aria-pressed", on ? "true" : "false");
        });
      }

      var activeFilter = "all";

      function render(){
        var dict = i18n[currentLang] || i18n.zh;
        var grid = document.getElementById("grid");
        if (!grid) return;
        grid.innerHTML = "";

        systems.forEach(function(sys){
          var node = buildItem(sys, currentLang, dict);
          grid.appendChild(node);
        });

        // apply filter + search
        applySearchAndFilter();
      }

      function applySearchAndFilter(){
        var qEl = document.getElementById("q");
        var q = qEl ? ((qEl.value || "").trim().toLowerCase()) : "";
        var nodes = document.querySelectorAll(".item");
        nodes.forEach(function(node){
          var tags = (node.dataset.tags || "");
          // auth filter is special: require auth tag
          var okFilter = (activeFilter === "all");
          if (activeFilter === "auth") okFilter = tags.indexOf("auth") !== -1;
          if (activeFilter === "life") okFilter = tags.indexOf("life") !== -1;
          if (activeFilter === "study") okFilter = tags.indexOf("study") !== -1;

          var okSearch = !q || (node.dataset.search || "").indexOf(q) !== -1;
          node.style.display = (okFilter && okSearch) ? "flex" : "none";
        });
      }

      // bindings
      document.getElementById("backBtn").addEventListener("click", function(){
        // Try history first; otherwise fallback
        if (window.history.length > 1) window.history.back();
        else window.location.href = "index.html";
      });

      document.querySelectorAll(".pill").forEach(function(btn){
        btn.addEventListener("click", function(){
          var lang = btn.dataset.lang;
          setSavedLang(lang);
          setLangButtons(lang);
          applyLanguage(lang);
        });
      });

      document.querySelectorAll(".chip").forEach(function(btn){
        btn.addEventListener("click", function(){
          activeFilter = btn.dataset.filter;
          setFilterButtons(activeFilter);
          applySearchAndFilter();
        });
      });

      var qInput = document.getElementById("q");
      if (qInput) qInput.addEventListener("input", applySearchAndFilter);
// init
      setLangButtons(currentLang);
      applyLanguage(currentLang);
      setFilterButtons(activeFilter);
    })();
  </script>
</body>
</html>
